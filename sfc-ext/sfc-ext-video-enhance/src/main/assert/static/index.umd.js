(function(e,p){typeof exports=="object"&&typeof module!="undefined"?p(require("vue")):typeof define=="function"&&define.amd?define(["vue"],p):(e=typeof globalThis!="undefined"?globalThis:e||self,p(e.Vue))})(this,function(e){"use strict";var We=Object.defineProperty,Ke=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var Je=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var H=(e,p,h)=>p in e?We(e,p,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[p]=h,V=(e,p)=>{for(var h in p||(p={}))Je.call(p,h)&&H(e,h,p[h]);if(q)for(var h of q(p))Ze.call(p,h)&&H(e,h,p[h]);return e},g=(e,p)=>Ke(e,Qe(p));const p=e.defineComponent({name:"SubtitleSelector"}),h=e.defineComponent(g(V({},p),{props:{subtitles:{type:Array,default:()=>[]}},setup(t){const o=t;return(c,l)=>{const r=e.resolveComponent("v-radio"),a=e.resolveComponent("v-radio-group");return e.openBlock(),e.createBlock(a,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.subtitles,i=>(e.openBlock(),e.createBlock(r,{key:i.index,color:"primary",label:`${i.language}${i.title?"("+i.title+")":""}`,value:i},null,8,["label","value"]))),128))]),_:1})}}})),z=[e.createElementVNode("h1",null,"\u64AD\u653E\u52A0\u8F7D\u5931\u8D25\u4E86QAQ",-1)],W=e.defineComponent({name:"VideoEnhancePlayer"}),K=e.defineComponent(g(V({},W),{props:{url:{type:String,default:void 0},videoInfo:{type:Object,default:void 0},subtitleUrls:{type:Array,default:()=>[]}},setup(t){const o=t,c=e.ref();let l;const r=()=>{if(!o.url)return;const a={container:c.value,video:{url:o.url}},i=e.ref();if(o.videoInfo){const s=o.videoInfo.streams.filter(n=>n.codecType=="subtitle");s.length&&(window.SfcUtils.snackbar(`\u68C0\u6D4B\u5230${s.length}\u4E2A\u5B57\u5E55`),a.contextmenu=[{text:"\u9009\u62E9\u5B57\u5E55",click(){window.SfcUtils.openComponentDialog(h,{props:e.reactive({subtitles:s,"onUpdate:modelValue"(n){i.value=n},modelValue:i}),title:"\u9009\u62E9\u5B57\u5E55",contentMaxHeight:"360px",async onConfirm(){const n=l.video.currentTime,k=o.subtitleUrls.find(C=>C.index==i.value.index);return k?(a.subtitle={url:k.url,fontSize:"21px"},a.contextmenu[0].text="\u5B57\u5E55\uFF1A"+i.value.language+(i.value.title?"("+i.value.title+")":""),l.destroy(),l=new window.DPlayer(a),l.play(),l.seek(n),!0):(window.SfcUtils.snackbar("\u627E\u4E0D\u5230\u6D41\u7F16\u53F7\u4E3A"+i.value+"\u7684\u5B57\u5E55\u6D41"),!0)}})}}]),o.videoInfo.chapters.length&&(a.highlight=o.videoInfo.chapters.map(n=>({text:n.title,time:Number(n.startTime)})))}l=new window.DPlayer(a),l.play()};return e.onMounted(async()=>{await e.nextTick(),r()}),e.watch(()=>o.url,r),(a,i)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"rootRef",ref:c},z,512))}})),Q=e.defineComponent({name:"ConfigureInfo"}),J=e.defineComponent(g(V({},Q),{props:{modelValue:{type:String,default:""}},setup(t){const o=t,c=()=>{window.SfcUtils.alert(o.modelValue,"\u7F16\u8BD1\u53C2\u6570")};return(l,r)=>(e.openBlock(),e.createElementBlock("a",{class:"link",onClick:c},"\u67E5\u770B\u7F16\u8BD1\u53C2\u6570"))}})),Z=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{style:{width:"90px"}}," \u7F16\u7801\u5668 "),e.createElementVNode("th",null,"\u63CF\u8FF0")])],-1),G={class:"break-text"},X=e.defineComponent({name:"EncoderInfoList"}),M=e.defineComponent(g(V({},X),{props:{modelValue:{type:Array,default:()=>[]}},setup(t){return(o,c)=>{const l=e.resolveComponent("VTable"),r=e.resolveComponent("EmptyTip");return t.modelValue&&t.modelValue.length?(e.openBlock(),e.createBlock(l,{key:0},{default:e.withCtx(()=>[Z,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.modelValue,a=>(e.openBlock(),e.createElementBlock("tr",{key:a.name},[e.createElementVNode("td",G,e.toDisplayString(a.name),1),e.createElementVNode("td",null,e.toDisplayString(a.describe),1)]))),128))])]),_:1})):(e.openBlock(),e.createBlock(r,{key:1}))}}})),Y=e.defineComponent({name:"EncoderInfo"}),v=e.defineComponent(g(V({},Y),{props:{modelValue:{type:Array,default:()=>[]}},setup(t){const o=t,c=()=>{window.SfcUtils.openComponentDialog(M,{props:{modelValue:o.modelValue},title:"\u7F16\u7801\u5668\u8BE6\u60C5"})};return(l,r)=>(e.openBlock(),e.createElementBlock("a",{class:"link",onClick:c},"\u67E5\u770B\u8BE6\u60C5("+e.toDisplayString(t.modelValue.length)+"\u4E2A)",1))}}));window.bootContext.addProcessor({taskName:"\u6CE8\u518C\u7EC4\u4EF6",execute(t,o){t.component("ConfigureInfo",J),t.component("EncoderInfo",v),t.component("EncoderInfoList",M)}});function L(t){return t<10?"0"+t:""+t}var T;(t=>{function o(l){return l<1e3?l+"bps":l<1e6?(Number(l)/1e3).toFixed(2)+"Kbps":l<1e9?(Number(l)/1e6).toFixed(2)+"Mbps":l}t.formatBitRate=o;function c(l){const r=Number(l),a=L(Math.floor(r/3600)),i=L(Math.floor(r/60%60)),s=L(Math.floor(r%60));return`${a}:${i}:${s}`}t.formatDuration=c})(T||(T={}));const ee=e.createElementVNode("div",{class:"text-title"}," \u57FA\u672C\u4FE1\u606F ",-1),te=e.createElementVNode("td",{style:{"min-width":"160px"}}," \u5C01\u88C5\u683C\u5F0F ",-1),oe=e.createElementVNode("td",null,"\u5C01\u88C5\u683C\u5F0F\u5168\u79F0",-1),ne=e.createElementVNode("td",null,"\u7801\u7387",-1),le=e.createElementVNode("td",null,"\u6301\u7EED\u65F6\u957F",-1),ae={key:0},re=e.createElementVNode("td",null,"\u5176\u4ED6\u6807\u8BB0",-1),ce=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"\u540D\u79F0"),e.createElementVNode("th",null,"\u503C")])],-1),ie=e.createElementVNode("div",{class:"text-title"}," \u89C6\u9891\u6D41 ",-1),de=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"\u7F16\u7801"),e.createElementVNode("th",null,"\u5206\u8FA8\u7387"),e.createElementVNode("th",null,"\u5E27\u7387"),e.createElementVNode("th",null,"\u8BED\u8A00")])],-1),se=e.createElementVNode("div",{class:"text-title"}," \u97F3\u9891\u6D41 ",-1),me=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"\u7F16\u7801"),e.createElementVNode("th",null,"\u91C7\u6837"),e.createElementVNode("th",null,"\u7801\u7387"),e.createElementVNode("th",null,"\u58F0\u9053"),e.createElementVNode("th",null,"\u8BED\u8A00")])],-1),ue=e.defineComponent({name:"VideoInfo"}),pe=e.defineComponent(g(V({},ue),{props:{videoInfo:{type:Object,default:()=>({})},file:{type:Object,default:void 0}},setup(t){const o=t,c=e.ref(!1),l=e.computed(()=>o.videoInfo.streams.filter(a=>a.codecType=="video")),r=e.computed(()=>o.videoInfo.streams.filter(a=>a.codecType=="audio"));return(a,i)=>{const s=e.resolveComponent("VTable");return e.openBlock(),e.createElementBlock("div",null,[ee,e.createVNode(s,null,{default:e.withCtx(()=>[e.createElementVNode("tbody",null,[e.createElementVNode("tr",null,[te,e.createElementVNode("td",null,e.toDisplayString(t.videoInfo.format.formatName),1)]),e.createElementVNode("tr",null,[oe,e.createElementVNode("td",null,e.toDisplayString(t.videoInfo.format.formatLongName),1)]),e.createElementVNode("tr",null,[ne,e.createElementVNode("td",null,e.toDisplayString(e.unref(T).formatBitRate(t.videoInfo.format.bitRate))+" ("+e.toDisplayString(t.videoInfo.format.bitRate)+")",1)]),e.createElementVNode("tr",null,[le,e.createElementVNode("td",null,e.toDisplayString(e.unref(T).formatDuration(t.videoInfo.format.duration)),1)]),t.videoInfo.format.tags?(e.openBlock(),e.createElementBlock("tr",ae,[re,e.createElementVNode("td",null,[c.value?(e.openBlock(),e.createBlock(s,{key:0},{default:e.withCtx(()=>[ce,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Object.keys(t.videoInfo.format.tags),n=>(e.openBlock(),e.createElementBlock("tr",{key:n},[e.createElementVNode("td",null,e.toDisplayString(n),1),e.createElementVNode("td",null,e.toDisplayString(t.videoInfo.format.tags[n]),1)]))),128))])]),_:1})):e.createCommentVNode("",!0),e.createElementVNode("a",{class:"link",onClick:i[0]||(i[0]=n=>c.value=!c.value)},e.toDisplayString(c.value?"\u6536\u8D77":"\u5C55\u5F00"),1)])])):e.createCommentVNode("",!0)])]),_:1}),ie,e.createVNode(s,null,{default:e.withCtx(()=>[de,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),n=>(e.openBlock(),e.createElementBlock("tr",{key:n.index},[e.createElementVNode("td",null,e.toDisplayString(n.codecName),1),e.createElementVNode("td",null,e.toDisplayString(n.width)+"x"+e.toDisplayString(n.height),1),e.createElementVNode("td",null,e.toDisplayString((n.avgFrameRate||0).toFixed(3)),1),e.createElementVNode("td",null,e.toDisplayString(n.language||"-"),1)]))),128))])]),_:1}),se,e.createVNode(s,null,{default:e.withCtx(()=>[me,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),n=>(e.openBlock(),e.createElementBlock("tr",{key:n.index},[e.createElementVNode("td",null,e.toDisplayString(n.codecName),1),e.createElementVNode("td",null,e.toDisplayString(n.sampleRate/1e3)+"kHz",1),e.createElementVNode("td",null,e.toDisplayString(n.bitRate/1e3)+"K",1),e.createElementVNode("td",null,e.toDisplayString(n.channels),1),e.createElementVNode("td",null,e.toDisplayString(n.language||"-"),1)]))),128))])]),_:1})])}}}));var b;(t=>{function o(){return{url:"/video/getFFMpegInfo"}}t.getFFMpegInfo=o;function c(a){return{url:"/video/encodeConvert",data:a,method:"post",headers:{"Content-Type":"application/json"}}}t.encodeConvert=c;function l(a,i,s,n){return{url:"/video/listConvertTask",params:{uid:a,status:i,page:s,pageSize:n}}}t.listConvertTask=l;function r(a){return{url:"/video/getLog",params:{taskId:a}}}t.getLog=r})(b||(b={}));const fe=e.createElementVNode("div",{class:"text-h6"}," \u89C6\u9891 ",-1),Ee=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{style:{width:"64px"}}," \u9009\u62E9 "),e.createElementVNode("th",null,"\u539F\u7F16\u7801"),e.createElementVNode("th",null,"\u8BED\u8A00"),e.createElementVNode("th",null,"\u7F16\u7801\u5668")])],-1),ye=e.createElementVNode("div",{class:"text-h6"}," \u97F3\u9891 ",-1),ke=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",{style:{width:"64px"}}," \u9009\u62E9 "),e.createElementVNode("th",null,"\u539F\u7F16\u7801"),e.createElementVNode("th",null,"\u8BED\u8A00"),e.createElementVNode("th",null,"\u7F16\u7801\u5668")])],-1),he=e.defineComponent({name:"VideoConvertForm"}),Ve=e.defineComponent(g(V({},he),{props:{videoInfo:{type:Object,default:()=>({})}},emits:["submit"],setup(t,{expose:o,emit:c}){const l=t,r=e.ref(),a=e.ref(),i={title:"\u590D\u5236",value:"copy"},s=window.FormUtils.defineForm({actions:{async submit(){if(!l.videoInfo.streams.find(m=>(m.codecType=="audio"||m.codecType=="video")&&n.mapStreams[m.index]))throw new Error("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u97F3\u9891\u6216\u89C6\u9891\u6D41");l.videoInfo.streams.find(m=>m.codecType=="video"&&n.mapStreams[m.index])||await window.SfcUtils.confirm("\u6CA1\u6709\u9009\u62E9\u89C6\u9891\u6D41\uFF0C\u786E\u5B9A\uFF1F","\u63D0\u793A",{cancelToReject:!0}),l.videoInfo.streams.find(m=>m.codecType=="audio"&&n.mapStreams[m.index])||await window.SfcUtils.confirm("\u6CA1\u6709\u9009\u62E9\u97F3\u9891\u6D41\uFF0C\u786E\u5B9A\uFF1F","\u63D0\u793A",{cancelToReject:!0}),w()},async loadFFMpegInfo(){_.beginLoading();try{const d=(await window.SfcUtils.request(b.getFFMpegInfo())).data.data;a.value=d,E.video=[i].concat(d.videoEncoders.filter(m=>m.name.includes("264")||m.name.includes("265")||m.name.includes("hevc")).map(m=>({title:m.name,value:m.name}))),E.audio=[i].concat(d.audioEncoders.filter(m=>m.name.includes("aac")).map(m=>({title:m.name,value:m.name}))),E.subtitle=[i].concat(d.subtitleEncoders.map(m=>({title:m.name,value:m.name})))}catch(d){window.SfcUtils.snackbar(d)}finally{_.closeLoading()}}},formData:{convertRules:{},mapStreams:{},enabledConvertRules:[]},formRef:r,validators:{},throwError:!0}),{formData:n,actions:k,validators:C,loadingRef:B,loadingManager:_}=s,w=()=>{n.enabledConvertRules=l.videoInfo.streams.filter(d=>n.mapStreams[d.index]).map(d=>n.convertRules[d.index]),n.enabledConvertRules.forEach(d=>{d.encoder!="copy"?d.method="convert":d.method="copy"})};l.videoInfo.streams.forEach(d=>{n.convertRules[d.index]={index:d.index,encoder:"copy",method:"copy",type:d.codecType},n.mapStreams[d.index]=!0}),w(),e.onMounted(async()=>{await k.loadFFMpegInfo()});const S=e.computed(()=>l.videoInfo.streams.filter(d=>d.codecType=="video")),u=e.computed(()=>l.videoInfo.streams.filter(d=>d.codecType=="audio"));e.computed(()=>l.videoInfo.streams.filter(d=>d.codecType=="subtitle"));const E=e.reactive({video:[],audio:[],subtitle:[]});return o(s),(d,m)=>{const I=e.resolveComponent("LoadingMask"),x=e.resolveComponent("VCheckbox"),U=e.resolveComponent("FormSelect"),y=e.resolveComponent("VTable"),ze=e.resolveComponent("base-form");return e.openBlock(),e.createBlock(ze,{ref_key:"formRef",ref:r,"model-value":e.unref(n),"submit-action":e.unref(k).submit},{default:e.withCtx(()=>[e.createVNode(I,{loading:e.unref(B)},null,8,["loading"]),fe,e.createVNode(y,null,{default:e.withCtx(()=>[Ee,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(S),f=>(e.openBlock(),e.createElementBlock("tr",{key:f.index},[e.createElementVNode("td",null,[e.createVNode(x,{modelValue:e.unref(n).mapStreams[f.index],"onUpdate:modelValue":D=>e.unref(n).mapStreams[f.index]=D,color:"primary",style:{"margin-top":"6px"},density:"comfortable","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,e.toDisplayString(f.codecName),1),e.createElementVNode("td",null,e.toDisplayString(f.language||"-"),1),e.createElementVNode("td",null,[e.unref(E).video.length?(e.openBlock(),e.createBlock(U,{key:0,modelValue:e.unref(n).convertRules[f.index].encoder,"onUpdate:modelValue":D=>e.unref(n).convertRules[f.index].encoder=D,disabled:!e.unref(n).mapStreams[f.index],style:{width:"160px"},items:e.unref(E).video,onChange:w},null,8,["modelValue","onUpdate:modelValue","disabled","items"])):e.createCommentVNode("",!0)])]))),128))])]),_:1}),ye,e.createVNode(y,null,{default:e.withCtx(()=>[ke,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),f=>(e.openBlock(),e.createElementBlock("tr",{key:f.index},[e.createElementVNode("td",null,[e.createVNode(x,{modelValue:e.unref(n).mapStreams[f.index],"onUpdate:modelValue":D=>e.unref(n).mapStreams[f.index]=D,color:"primary",style:{"margin-top":"6px"},density:"comfortable","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),e.createElementVNode("td",null,e.toDisplayString(f.codecName),1),e.createElementVNode("td",null,e.toDisplayString(f.language||"-"),1),e.createElementVNode("td",null,[e.unref(E).audio.length?(e.openBlock(),e.createBlock(U,{key:0,modelValue:e.unref(n).convertRules[f.index].encoder,"onUpdate:modelValue":D=>e.unref(n).convertRules[f.index].encoder=D,disabled:!e.unref(n).mapStreams[f.index],style:{width:"160px"},items:e.unref(E).audio,onChange:w},null,8,["modelValue","onUpdate:modelValue","disabled","items"])):e.createCommentVNode("",!0)])]))),128))])]),_:1})]),_:1},8,["model-value","submit-action"])}}})),ge={style:{padding:"16px"}},Ce={class:"d-flex align-center"},_e={style:{padding:"0 8px",flex:"1"}},we={class:"break-text"},Ne={class:"tip",style:{"line-height":"16px"}},Fe={key:0},Be={key:1},De={key:2},be={key:3},xe={key:0,class:"break-text"},Se={class:"min-width: 64px"},Ie=e.createElementVNode("div",null,[e.createElementVNode("a",{style:{"font-size":"9px"}},"\u67E5\u770B\u65E5\u5FD7")],-1),Te=e.createElementVNode("div",null,[e.createElementVNode("a",{style:{"font-size":"9px"}},"\u53D6\u6D88")],-1),$e=e.defineComponent({name:"EncodeConvertTaskInfo"}),$=e.defineComponent(g(V({},$e),{props:{task:{type:Object,default(){return{}}},haveLog:{type:Boolean,default:!1},showCancel:{type:Boolean,default:!1}},setup(t){const o=t,c=e.computed(()=>JSON.parse(o.task.params||"{}")),l=window.StringFormatter.toDate,r=async()=>{const i=window.SfcUtils.loadingDialog();try{const s=(await window.SfcUtils.request(b.getLog(o.task.asyncTaskRecord.id))).data.data;s?window.SfcUtils.openComponentDialog(window.components.CodeEditor,{props:{modelValue:s.taskLog,readOnly:!0,useMiniMap:!0,style:{height:"100%"}},fullscreen:!0}):window.SfcUtils.alert("\u6CA1\u80FD\u67E5\u8BE2\u5230\u65E5\u5FD7")}catch(s){window.SfcUtils.alert(s,"\u9519\u8BEF")}finally{i.close()}},a=async()=>{const i=window.SfcUtils.loadingDialog({msg:"\u8BF7\u6C42\u4E2D..."});try{await window.SfcUtils.sleep(150),await window.SfcUtils.request(window.API.asyncTask.interrupt(o.task.asyncTaskRecord.id)),i.close()}catch(s){i.close(),await window.SfcUtils.sleep(250),window.SfcUtils.alert("\u8BF7\u6C42\u5931\u8D25: "+s)}};return(i,s)=>{var B,_;const n=e.resolveComponent("FileIcon"),k=e.resolveComponent("VProgressLinear"),C=e.resolveComponent("CommonIcon");return e.openBlock(),e.createElementBlock("div",ge,[e.createElementVNode("div",Ce,[e.createElementVNode("div",null,[e.createVNode(n,{width:"36","file-name":"aaa.mp4"})]),e.createElementVNode("div",_e,[e.createElementVNode("div",we,[e.createElementVNode("div",null,e.toDisplayString((_=(B=e.unref(c))==null?void 0:B.source)==null?void 0:_.name),1),e.createElementVNode("div",Ne,[t.task.asyncTaskRecord.executeDate?(e.openBlock(),e.createElementBlock("div",Fe," \u6267\u884C\u65E5\u671F: "+e.toDisplayString(e.unref(l)(t.task.asyncTaskRecord.executeDate)),1)):e.createCommentVNode("",!0),t.task.asyncTaskRecord.finishDate?(e.openBlock(),e.createElementBlock("div",Be," \u5B8C\u6210\u65E5\u671F: "+e.toDisplayString(e.unref(l)(t.task.asyncTaskRecord.finishDate)),1)):e.createCommentVNode("",!0),t.task.asyncTaskRecord.failedDate?(e.openBlock(),e.createElementBlock("div",De," \u5931\u8D25\u65E5\u671F: "+e.toDisplayString(e.unref(l)(t.task.asyncTaskRecord.failedDate)),1)):e.createCommentVNode("",!0),t.task.asyncTaskRecord.executeDate?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",be,e.toDisplayString(t.task.asyncTaskRecord.status==4?"\u5DF2\u53D6\u6D88":"\u7B49\u5F85\u4E2D"),1))])]),t.task.progress?(e.openBlock(),e.createElementBlock("div",xe,[e.createVNode(k,{color:"primary","model-value":t.task.progress.loaded,max:t.task.progress.total},null,8,["model-value","max"])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",Se,[e.createElementVNode("div",{class:"text-center link",onClick:r},[e.createElementVNode("div",null,[e.createVNode(C,{color:"primary",icon:"mdi-eye"})]),Ie]),t.showCancel?(e.openBlock(),e.createElementBlock("div",{key:0,class:"text-center link",style:{"margin-left":"12px"},onClick:a},[e.createElementVNode("div",null,[e.createVNode(C,{color:"primary",icon:"mdi-close"})]),Te])):e.createCommentVNode("",!0)])])])}}})),Ue=e.createTextVNode(" \u8FDB\u884C\u4E2D"),Le=e.createTextVNode(" \u5DF2\u5B8C\u6210"),Ae={key:0},Re=e.createTextVNode(" \u6267\u884C\u5931\u8D25"),Pe={key:0},Me=e.defineComponent({name:"EncodeConvertTask",components:{EncodeConvertTaskInfo:$}}),Oe=e.defineComponent(g(V({},Me),{props:{uid:{type:[String,Number],default:0}},setup(t){const o=t,c=e.ref("1"),l=e.ref(0),r=e.ref([]),a=e.ref([]),i=e.ref(0),s=e.ref([]),n=e.ref(0),k=async u=>(await window.SfcUtils.request(b.listConvertTask(o.uid,u,0,20))).data.data,C=async()=>{const u=k(1),E=k(0),d=await Promise.all([u,E]);l.value=Number(d[0].totalCount)||0,r.value=d[0].content,l.value+=Number(d[1].totalCount),r.value=r.value.concat(d[1].content)},B=async()=>{const u=await k(2);i.value=u.totalCount,a.value=u.content},_=async()=>{const u=await Promise.all([k(3),k(4)]);n.value=Number(u[0].totalCount)+Number(u[1].totalCount),s.value=(u[0].content||[]).concat(u[1].content)};let w,S=!1;return e.onMounted(()=>{B(),C(),_(),w=setInterval(async()=>{if(!S)try{S=!0;let u;c.value=="1"?u=C():c.value=="2"?u=B():u=_(),await u}finally{S=!1}},2500)}),e.onUnmounted(()=>{w&&clearInterval(w)}),(u,E)=>{const d=e.resolveComponent("v-tab"),m=e.resolveComponent("v-tabs"),I=e.resolveComponent("EmptyTip"),x=e.resolveComponent("v-window-item"),U=e.resolveComponent("v-window");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(m,{modelValue:c.value,"onUpdate:modelValue":E[0]||(E[0]=y=>c.value=y),color:"primary","fixed-tabs":""},{default:e.withCtx(()=>[e.createVNode(d,{value:"1"},{default:e.withCtx(()=>[Ue,e.createElementVNode("span",null,"("+e.toDisplayString(l.value)+")",1)]),_:1}),e.createVNode(d,{value:"2"},{default:e.withCtx(()=>[Le,i.value?(e.openBlock(),e.createElementBlock("span",Ae,"("+e.toDisplayString(i.value)+")",1)):e.createCommentVNode("",!0)]),_:1}),e.createVNode(d,{value:"3"},{default:e.withCtx(()=>[Re,n.value?(e.openBlock(),e.createElementBlock("span",Pe,"("+e.toDisplayString(n.value)+")",1)):e.createCommentVNode("",!0)]),_:1})]),_:1},8,["modelValue"]),e.createVNode(U,{modelValue:c.value,"onUpdate:modelValue":E[1]||(E[1]=y=>c.value=y)},{default:e.withCtx(()=>[e.createVNode(x,{value:"1"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,y=>(e.openBlock(),e.createBlock($,{key:y.id,task:y,"show-cancel":""},null,8,["task"]))),128)),r.value.length?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(I,{key:0}))]),_:1}),e.createVNode(x,{value:"2"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,y=>(e.openBlock(),e.createBlock($,{key:y.id,task:y,"have-log":!0},null,8,["task"]))),128)),a.value.length?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(I,{key:0}))]),_:1}),e.createVNode(x,{value:"3"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,y=>(e.openBlock(),e.createBlock($,{key:y.id,task:y,"have-log":!0},null,8,["task"]))),128)),s.value.length?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(I,{key:0}))]),_:1})]),_:1},8,["modelValue"])])}}})),N=window.context,F=window.SfcUtils;function je(t,o,c,l){if(!o.name.endsWith(".mkv"))return null;const r={name:o.name,path:c,protocol:"subtitle",targetId:t.uid,stream:l};if(t.protocol=="main")return window.SfcUtils.getApiUrl(window.API.resource.getCommonResource(r));const a=t.getProtocolParams();return r.sourceProtocol=t.protocol,r.sourceId=a.id,Object.keys(a).filter(i=>i!="id").forEach(i=>{r[i]=a[i]}),window.SfcUtils.getApiUrl(window.API.resource.getCommonResource(r))}async function A(t,o,c){const l={name:o.name,path:c,targetId:t.uid,sourceProtocol:t.protocol||"main",protocol:t.protocol||"main"},r=t.getProtocolParams();return l.sourceId=r.id,Object.keys(r).filter(a=>a!="id").forEach(a=>{l[a]=r[a]}),l}async function R(t,o,c){const l=await A(t,o,c);return l.protocol="videoInfo",(await await F.request(window.API.resource.getCommonResource(l))).data}const qe=new Set(["mp4","mkv","avi","rm","rmvb","m4v","flv","mpg","mpeg","mpe","ts"]);function P(t){const o=t.split(".").pop();return!!o&&qe.has(o)}const O={id:"player",icon:"mdi-play-circle",matcher(t,o){return P(o.name)},title:"\u64AD\u653E\u89C6\u9891",async action(t,o){try{let c=o.path;c||(c=(await F.request(window.API.resource.parseNodeId(o.uid,o.node))).data.data),F.beginLoading(),await window.SfcUtils.sleep(100);const l=await R(t,o,c);F.openComponentDialog(K,{props:{url:t.getFileUrl(o),videoInfo:l,subtitleUrls:l.streams.filter(r=>r.codecType=="subtitle").map(r=>({index:r.index,url:je(t,o,c,r.index)}))},dense:!0,showCancel:!1,title:"\u89C6\u9891\u9884\u89C8\uFF1A"+o.name,extraDialogOptions:{maxWidth:"80%"}})}catch(c){F.snackbar(c)}finally{F.closeLoading()}},sort:0},He={id:"video",name:"\u89C6\u9891",items:[{title:"\u89C6\u9891\u8F6C\u7801",id:"video-convert",icon:"mdi-cached",renderOn(t){return t&&t.selectFileList.length==1&&!t.selectFileList[0].mount&&P(t.selectFileList[0].name)&&!t.readonly},async action(t){const o=t.selectFileList[0],c=await R(t,o,o.path),l=window.SfcUtils.openComponentDialog(Ve,{props:{videoInfo:c},title:`\u89C6\u9891\u8F6C\u7801\uFF1A${t.selectFileList[0].name}`,async onConfirm(){const r=window.SfcUtils.loadingDialog({msg:"\u4EFB\u52A1\u521B\u5EFA\u4E2D"});try{if((await l.getInstAsForm().submit()).success){const i=l.getInstAsForm().getFormData().enabledConvertRules,s=await A(t,o,o.path),n=await A(t,o,o.path);return n.name="convert_"+n.name,await window.SfcUtils.request(b.encodeConvert({rules:i,source:s,target:n})),window.SfcUtils.snackbar("\u4EFB\u52A1\u521B\u5EFA\u6210\u529F"),!0}else return!1}catch(a){return F.snackbar(a),!1}finally{r.close()}}})}},{title:"\u89C6\u9891\u4FE1\u606F",id:"video-info",renderOn(t){return t&&t.selectFileList.length==1&&!t.selectFileList[0].mount&&P(t.selectFileList[0].name)},icon:"mdi-information-variant",async action(t){const o=await R(t,t.selectFileList[0],t.selectFileList[0].path);window.SfcUtils.openComponentDialog(pe,{props:{videoInfo:o},title:`\u5A92\u4F53\u4FE1\u606F\uFF1A${t.selectFileList[0].name}`})}}]};N.menu.value.boxMenu.push({name:"\u89C6\u9891\u670D\u52A1",id:"video",items:[{id:"encoder-convert",title:"\u89C6\u9891\u8F6C\u7801",icon:"mdi-cached",renderOn(){return!!N.session.value.token},action(t){t.title="\u89C6\u9891\u8F6C\u7801",t.currentComponent=e.h(Oe,{style:{maxWidth:"640px",margin:"auto"},uid:N.session.value.user.id})}}]});const j=N.fileOpenHandler.value.findIndex(t=>t.id=="play-video");j!=-1?N.fileOpenHandler.value[j]=O:N.fileOpenHandler.value.push(O),N.menu.value.fileListMenu.push(He)});
