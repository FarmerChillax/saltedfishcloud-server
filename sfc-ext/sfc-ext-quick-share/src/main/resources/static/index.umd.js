(function(t,e){typeof exports=="object"&&typeof module!="undefined"?e(require("sfc-common"),require("vue")):typeof define=="function"&&define.amd?define(["sfc-common","vue"],e):(t=typeof globalThis!="undefined"?globalThis:t||self,e(t.SfcCommon,t.Vue))})(this,function(t,e){"use strict";var J=Object.defineProperty,K=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var w=(t,e,o)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,y=(t,e)=>{for(var o in e||(e={}))Y.call(e,o)&&w(t,o,e[o]);if(S)for(var o of S(e))Z.call(e,o)&&w(t,o,e[o]);return t},N=(t,e)=>K(t,X(e));const o={prefix:"/quickShare",feature:{isEnable:"quickshare.is-enable",maxSize:"quickshare.max-size",effectiveDuration:"quickshare.effective-duration"},upload(l,u){const n=new FormData;return n.set("file",l),{url:`${this.prefix}/upload`,params:u,data:n,method:"post"}},getByCode(l){return{url:`${this.prefix}/getByCode`,params:{code:l}}},getShareFile(l){return{url:`${this.prefix}/getShareFile?id=${l}`}}};var ee="",b=(l,u)=>{const n=l.__vccOpts||l;for(const[r,p]of u)n[r]=p;return n};const k=l=>(e.pushScopeId("data-v-8c04ab2a"),l=l(),e.popScopeId(),l),A={style:{width:"100%","max-width":"810px",margin:"0 auto",padding:"12px"}},B=e.createTextVNode(" \u63A5\u6536\u6587\u4EF6 "),U=e.createTextVNode(" \u53D1\u9001\u6587\u4EF6 "),q={style:{padding:"12px"}},I=e.createTextVNode(" \u63D0\u53D6 "),T={class:"tip"},z=k(()=>e.createElementVNode("br",null,null,-1)),M={style:{padding:"12px"}},P=e.createTextVNode(" \u53D1\u9001\uFF0C\u8D70\u4F60~ "),R=e.defineComponent({name:"QuickShareView",components:{CommonIcon:t.Components.CommonIcon}}),W=e.defineComponent(N(y({},R),{props:{},setup(l){const u=e.ref("1"),n=e.ref(""),r=e.ref(""),p=e.ref([]),h=e.ref(""),C=e.ref(),E=e.ref(),$=512,g=(t.context.feature.value[o.feature.maxSize]||$)*1024*1024,V={sendCode:[t.Validators.maxLen(null,20),t.Validators.minLen(null,1)],extractCode:[t.Validators.notNull()],file:[t.Validators.requireFile(),t.Validators.fileMaxSize(g)],message:[t.Validators.maxLen(null,255)]},j=async()=>{const F=await E.value.validate();if(!F.valid){t.SfcUtils.snackbar("\u6821\u9A8C\u5931\u8D25:"+F.errors.map(i=>i.errorMessages).join(";"));return}const a=t.SfcUtils.loadingDialog({msg:"\u6B63\u5728\u83B7\u53D6\u5206\u4EAB\u4FE1\u606F"});try{const c=(await t.SfcUtils.request(o.getByCode(n.value))).data.data;c.message&&t.SfcUtils.alert(c.message,"\u5206\u4EAB\u7559\u8A00").then(()=>t.SfcUtils.openApiUrl(o.getShareFile(c.id)))}catch(i){t.SfcUtils.alert("\u83B7\u53D6\u9519\u8BEF: "+i),console.error(i)}finally{a.close()}},L=async()=>{const F=await C.value.validate();if(!F.valid){t.SfcUtils.snackbar("\u6821\u9A8C\u5931\u8D25:"+F.errors.map(s=>s.errorMessages).join(";"));return}const a=e.reactive({msg:"\u4E0A\u4F20\u4E2D"}),i=t.SfcUtils.loadingDialog(a),c=o.upload(p.value[0],{code:r.value,message:h.value});c.onUploadProgress=s=>{a.msg="\u4E0A\u4F20\u4E2D..."+(s.loaded/s.total*100).toFixed(2)+"%"};try{const f=(await t.SfcUtils.request(c)).data.data;let m=["\u53D1\u9001\u6210\u529F\uFF0C\u63D0\u53D6\u7801\u4E3A\uFF1A"+f];f!=r.value&&m.push("(\u63D0\u53D6\u7801\u51B2\u7A81\uFF0C\u7CFB\u7EDF\u968F\u673A\u65B0\u751F\u6210)");const _=t.StringUtils.appendPath(location.origin,"/#/box/quick-share?code="+f);t.SfcUtils.openComponentDialog(e.h("div",null,[...m.map(x=>e.h("div",null,x)),e.h("div",null,[e.h("span",null,"\u63D0\u53D6\u94FE\u63A5\uFF1A"),e.h("a",{class:"link",onClick:()=>{t.SfcUtils.copyToClipboard(_),t.SfcUtils.snackbar("\u590D\u5236\u6210\u529F")}},_)]),e.h("div",null,"\u6216\u901A\u8FC7\u3010\u767E\u5B9D\u7BB1 - \u6587\u4EF6\u6781\u901F\u4F20\u3011\u529F\u80FD\u4E2D\u76F4\u63A5\u8F93\u5165\u63D0\u53D6\u7801\u63D0\u53D6")]),{showCancel:!1})}catch(s){t.SfcUtils.alert("\u53D1\u9001\u5931\u8D25: "+s),console.error(s)}finally{i.close()}};return(F,a)=>{const i=e.resolveComponent("CommonIcon"),c=e.resolveComponent("v-tab"),s=e.resolveComponent("v-tabs"),f=e.resolveComponent("v-text-field"),m=e.resolveComponent("VBtn"),_=e.resolveComponent("VForm"),x=e.resolveComponent("VWindowItem"),v=e.resolveComponent("v-file-input"),O=e.resolveComponent("VTextarea"),Q=e.resolveComponent("VWindow"),G=e.resolveComponent("VCardContent"),H=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",A,[e.createVNode(H,{title:"\u6587\u4EF6\u6781\u901F\u4F20"},{default:e.withCtx(()=>[e.createVNode(s,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=d=>u.value=d),"bg-color":"primary",color:"primary"},{default:e.withCtx(()=>[e.createVNode(c,{value:"1"},{default:e.withCtx(()=>[e.createVNode(i,{icon:"mdi-folder-download"}),B]),_:1}),e.createVNode(c,{value:"2"},{default:e.withCtx(()=>[e.createVNode(i,{icon:"mdi-send"}),U]),_:1})]),_:1},8,["modelValue"]),e.createVNode(G,null,{default:e.withCtx(()=>[e.createVNode(Q,{modelValue:u.value,"onUpdate:modelValue":a[5]||(a[5]=d=>u.value=d)},{default:e.withCtx(()=>[e.createVNode(x,{value:"1"},{default:e.withCtx(()=>[e.createVNode(_,{ref_key:"extractFormRef",ref:E},{default:e.withCtx(()=>[e.createElementVNode("div",q,[e.createVNode(f,{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=d=>n.value=d),clearable:"",label:"\u8BF7\u8F93\u5165\u6587\u4EF6\u63D0\u53D6\u7801",color:"primary",rules:V.extractCode,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(m,{color:"primary",style:{display:"block",width:"100%"},onClick:j},{default:e.withCtx(()=>[I]),_:1})])]),_:1},512)]),_:1}),e.createVNode(x,{value:"2"},{default:e.withCtx(()=>[e.createVNode(_,{ref_key:"sendFormRef",ref:C},{default:e.withCtx(()=>[e.createElementVNode("div",T,[e.createTextVNode(" \u6587\u4EF6\u4FDD\u7559\u65F6\u957F\uFF1A"+e.toDisplayString(e.unref(t.context).feature.value[e.unref(o).feature.effectiveDuration]||30)+"\u5206\u949F",1),z,e.createTextVNode(" \u6587\u4EF6\u5927\u5C0F\u9650\u5236\uFF1A"+e.toDisplayString(e.unref(t.StringFormatter).toSize(g)),1)]),e.createElementVNode("div",M,[e.createVNode(v,{modelValue:e.unref(p),"onUpdate:modelValue":a[2]||(a[2]=d=>e.isRef(p)?p.value=d:null),label:"\u8BF7\u9009\u62E9\u6587\u4EF6",rules:V.file,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(f,{modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=d=>r.value=d),clearable:"",label:"\u8BF7\u8F93\u5165\u6587\u4EF6\u63D0\u53D6\u7801",color:"primary",rules:V.sendCode,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(O,{modelValue:h.value,"onUpdate:modelValue":a[4]||(a[4]=d=>h.value=d),rules:V.message,label:"\u7559\u8A00",color:"primary",variant:"outlined"},null,8,["modelValue","rules"]),e.createVNode(m,{color:"primary",style:{display:"block",width:"100%"},onClick:L},{default:e.withCtx(()=>[e.createVNode(i,{icon:"mdi-send"}),P]),_:1})])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])}}}));var D=b(W,[["__scopeId","data-v-8c04ab2a"]]);window.bootContext.addProcessor({taskName:"\u6CE8\u518C\u7EC4\u4EF6 - \u6587\u4EF6\u5FEB\u901F\u4F20",execute(l){if(!t.context.feature.value[o.feature.isEnable])return;l.component(D.name,D);const u=t.context.menu.value.boxMenu.find(r=>r.id=="shareAndCollection"),n={id:"quick-share",icon:"mdi-flash",title:"\u6587\u4EF6\u6781\u901F\u4F20",action(r){r.title="\u6587\u4EF6\u6781\u901F\u4F20",r.currentComponent="quick-share-view"}};u?u.items.push(n):t.context.menu.value.boxMenu.push({id:"shareAndCollection",name:"\u6587\u4EF6\u4EA4\u6D41",items:[n]})}})});
