(function(t,e){typeof exports=="object"&&typeof module!="undefined"?e(require("sfc-common"),require("vue")):typeof define=="function"&&define.amd?define(["sfc-common","vue"],e):(t=typeof globalThis!="undefined"?globalThis:t||self,e(t.SfcCommon,t.Vue))})(this,function(t,e){"use strict";var J=Object.defineProperty,K=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var w=(t,e,a)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,N=(t,e)=>{for(var a in e||(e={}))X.call(e,a)&&w(t,a,e[a]);if(y)for(var a of y(e))Y.call(e,a)&&w(t,a,e[a]);return t},S=(t,e)=>K(t,O(e));const a={prefix:"/quickShare",feature:{isEnable:"quickshare.is-enable",maxSize:"quickshare.max-size",effectiveDuration:"quickshare.effective-duration"},upload(p,d){const u=new FormData;return u.set("file",p),{url:`${this.prefix}/upload`,params:d,data:u,method:"post"}},getByCode(p){return{url:`${this.prefix}/getByCode`,params:{code:p}}},getShareFile(p){return{url:`${this.prefix}/getShareFile?id=${p}`}}},b={style:{width:"100%","max-width":"810px",margin:"0 auto",padding:"12px"}},k=e.createTextVNode(" \u63A5\u6536\u6587\u4EF6 "),A=e.createTextVNode(" \u53D1\u9001\u6587\u4EF6 "),B={style:{padding:"12px"}},U=e.createTextVNode(" \u63D0\u53D6 "),q={class:"tip"},T=e.createElementVNode("br",null,null,-1),I={style:{padding:"12px"}},z=e.createTextVNode(" \u53D1\u9001\uFF0C\u8D70\u4F60~ "),M=e.defineComponent({name:"QuickShareView",components:{CommonIcon:t.Components.CommonIcon}}),D=e.defineComponent(S(N({},M),{props:{},setup(p){const d=e.ref("1"),u=e.ref(""),s=e.ref(""),V=e.ref([]),h=e.ref(""),C=e.ref(),E=e.ref(),P=512,g=(t.context.feature.value[a.feature.maxSize]||P)*1024*1024,_={sendCode:[t.Validators.maxLen(null,20),t.Validators.minLen(null,1)],extractCode:[t.Validators.notNull()],file:[t.Validators.requireFile(),t.Validators.fileMaxSize(g)],message:[t.Validators.maxLen(null,255)]},R=async()=>{const r=await E.value.validate();if(!r.valid){t.SfcUtils.snackbar("\u6821\u9A8C\u5931\u8D25:"+r.errors.map(l=>l.errorMessages).join(";"));return}const o=t.SfcUtils.loadingDialog({msg:"\u6B63\u5728\u83B7\u53D6\u5206\u4EAB\u4FE1\u606F"});try{const c=(await t.SfcUtils.request(a.getByCode(u.value))).data.data;c.message&&t.SfcUtils.alert(c.message,"\u63D0\u53D6\u6210\u529F - \u7559\u8A00").then(()=>t.SfcUtils.openApiUrl(a.getShareFile(c.id)))}catch(l){t.SfcUtils.alert("\u83B7\u53D6\u9519\u8BEF: "+l),console.error(l)}finally{o.close()}},W=async()=>{const r=await C.value.validate();if(!r.valid){t.SfcUtils.snackbar("\u6821\u9A8C\u5931\u8D25:"+r.errors.map(i=>i.errorMessages).join(";"));return}const o=e.reactive({msg:"\u4E0A\u4F20\u4E2D"}),l=t.SfcUtils.loadingDialog(o),c=a.upload(V.value[0],{code:s.value,message:h.value});c.onUploadProgress=i=>{o.msg="\u4E0A\u4F20\u4E2D..."+(i.loaded/i.total*100).toFixed(2)+"%"};try{const F=(await t.SfcUtils.request(c)).data.data;let f=["\u53D1\u9001\u6210\u529F\uFF0C\u63D0\u53D6\u7801\u4E3A\uFF1A"+F];F!=s.value&&f.push("(\u63D0\u53D6\u7801\u51B2\u7A81\uFF0C\u7CFB\u7EDF\u968F\u673A\u65B0\u751F\u6210)");const m=t.StringUtils.appendPath(location.origin,"/#/box/quick-share?code="+F);t.SfcUtils.openComponentDialog(e.h("div",null,[...f.map(x=>e.h("div",null,x)),e.h("div",null,[e.h("span",null,"\u63D0\u53D6\u94FE\u63A5\uFF1A"),e.h("a",{class:"link",onClick:()=>{t.SfcUtils.copyToClipboard(m),t.SfcUtils.snackbar("\u590D\u5236\u6210\u529F")}},m)]),e.h("div",null,"\u6216\u901A\u8FC7\u3010\u767E\u5B9D\u7BB1 - \u6587\u4EF6\u6781\u901F\u4F20\u3011\u529F\u80FD\u4E2D\u76F4\u63A5\u8F93\u5165\u63D0\u53D6\u7801\u63D0\u53D6")]),{showCancel:!1})}catch(i){t.SfcUtils.alert("\u53D1\u9001\u5931\u8D25: "+i),console.error(i)}finally{l.close()}},$=async()=>{var o;const r=(o=t.context.routeInfo.value.curr)==null?void 0:o.query;r&&r.code&&(u.value=r.code)};return e.onMounted(()=>{$()}),(r,o)=>{const l=e.resolveComponent("CommonIcon"),c=e.resolveComponent("v-tab"),i=e.resolveComponent("v-tabs"),F=e.resolveComponent("v-text-field"),f=e.resolveComponent("VBtn"),m=e.resolveComponent("VForm"),x=e.resolveComponent("VWindowItem"),j=e.resolveComponent("v-file-input"),L=e.resolveComponent("VTextarea"),Q=e.resolveComponent("VWindow"),G=e.resolveComponent("VCardContent"),H=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",b,[e.createVNode(H,{title:"\u6587\u4EF6\u6781\u901F\u4F20"},{default:e.withCtx(()=>[e.createVNode(i,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=n=>d.value=n),"bg-color":"primary",color:"primary"},{default:e.withCtx(()=>[e.createVNode(c,{value:"1"},{default:e.withCtx(()=>[e.createVNode(l,{icon:"mdi-folder-download"}),k]),_:1}),e.createVNode(c,{value:"2"},{default:e.withCtx(()=>[e.createVNode(l,{icon:"mdi-send"}),A]),_:1})]),_:1},8,["modelValue"]),e.createVNode(G,null,{default:e.withCtx(()=>[e.createVNode(Q,{modelValue:d.value,"onUpdate:modelValue":o[5]||(o[5]=n=>d.value=n)},{default:e.withCtx(()=>[e.createVNode(x,{value:"1"},{default:e.withCtx(()=>[e.createVNode(m,{ref_key:"extractFormRef",ref:E},{default:e.withCtx(()=>[e.createElementVNode("div",B,[e.createVNode(F,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=n=>u.value=n),clearable:"",label:"\u8BF7\u8F93\u5165\u6587\u4EF6\u63D0\u53D6\u7801",color:"primary",rules:_.extractCode,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(f,{color:"primary",style:{display:"block",width:"100%"},onClick:R},{default:e.withCtx(()=>[U]),_:1})])]),_:1},512)]),_:1}),e.createVNode(x,{value:"2"},{default:e.withCtx(()=>[e.createVNode(m,{ref_key:"sendFormRef",ref:C},{default:e.withCtx(()=>[e.createElementVNode("div",q,[e.createTextVNode(" \u6587\u4EF6\u4FDD\u7559\u65F6\u957F\uFF1A"+e.toDisplayString(e.unref(t.context).feature.value[e.unref(a).feature.effectiveDuration]||30)+"\u5206\u949F",1),T,e.createTextVNode(" \u6587\u4EF6\u5927\u5C0F\u9650\u5236\uFF1A"+e.toDisplayString(e.unref(t.StringFormatter).toSize(g)),1)]),e.createElementVNode("div",I,[e.createVNode(j,{modelValue:e.unref(V),"onUpdate:modelValue":o[2]||(o[2]=n=>e.isRef(V)?V.value=n:null),label:"\u8BF7\u9009\u62E9\u6587\u4EF6",rules:_.file,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(F,{modelValue:s.value,"onUpdate:modelValue":o[3]||(o[3]=n=>s.value=n),clearable:"",label:"\u8BF7\u8F93\u5165\u6587\u4EF6\u63D0\u53D6\u7801",color:"primary",rules:_.sendCode,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(L,{modelValue:h.value,"onUpdate:modelValue":o[4]||(o[4]=n=>h.value=n),rules:_.message,label:"\u7559\u8A00",color:"primary",variant:"outlined"},null,8,["modelValue","rules"]),e.createVNode(f,{color:"primary",style:{display:"block",width:"100%"},onClick:W},{default:e.withCtx(()=>[e.createVNode(l,{icon:"mdi-send"}),z]),_:1})])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])}}}));window.bootContext.addProcessor({taskName:"\u6CE8\u518C\u7EC4\u4EF6 - \u6587\u4EF6\u5FEB\u901F\u4F20",execute(p){if(!t.context.feature.value[a.feature.isEnable])return;p.component(D.name,D);const d=t.context.menu.value.boxMenu.find(s=>s.id=="shareAndCollection"),u={id:"quick-share",icon:"mdi-flash",title:"\u6587\u4EF6\u6781\u901F\u4F20",action(s){s.title="\u6587\u4EF6\u6781\u901F\u4F20",s.currentComponent="quick-share-view"}};d?d.items.push(u):t.context.menu.value.boxMenu.push({id:"shareAndCollection",name:"\u6587\u4EF6\u4EA4\u6D41",items:[u]})}})});
