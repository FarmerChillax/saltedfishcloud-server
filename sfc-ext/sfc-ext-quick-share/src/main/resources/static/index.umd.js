(function(t,e){typeof exports=="object"&&typeof module!="undefined"?e(require("sfc-common"),require("vue")):typeof define=="function"&&define.amd?define(["sfc-common","vue"],e):(t=typeof globalThis!="undefined"?globalThis:t||self,e(t.SfcCommon,t.Vue))})(this,function(t,e){"use strict";var J=Object.defineProperty,K=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var y=(t,e,o)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,w=(t,e)=>{for(var o in e||(e={}))X.call(e,o)&&y(t,o,e[o]);if(S)for(var o of S(e))Y.call(e,o)&&y(t,o,e[o]);return t},N=(t,e)=>K(t,O(e));const o={prefix:"/quickShare",feature:{isEnabled:"isEnabled",maxSize:"maxSize",effectiveDuration:"effectiveDuration"},featurePrefix:"quickshare",upload(p,s){const u=new FormData;return u.set("file",p),{url:`${this.prefix}/upload`,params:s,data:u,method:"post"}},getByCode(p){return{url:`${this.prefix}/getByCode`,params:{code:p}}},getShareFile(p){return{url:`${this.prefix}/getShareFile?id=${p}`}}},U={style:{width:"100%","max-width":"810px",margin:"0 auto",padding:"12px"}},b=e.createTextVNode(" \u63A5\u6536\u6587\u4EF6 "),A=e.createTextVNode(" \u53D1\u9001\u6587\u4EF6 "),k={style:{padding:"12px"}},B=e.createTextVNode(" \u63D0\u53D6 "),q={class:"tip"},T=e.createElementVNode("br",null,null,-1),P={style:{padding:"12px"}},I=e.createTextVNode(" \u53D1\u9001\uFF0C\u8D70\u4F60~ "),z=e.defineComponent({name:"QuickShareView",components:{CommonIcon:t.Components.CommonIcon}}),D=e.defineComponent(N(w({},z),{props:{},setup(p){const s=e.ref("1"),u=e.ref(""),c=e.ref(""),V=e.ref([]),h=e.ref(""),C=e.ref(),g=e.ref(),M=512,E=(t.SfcUtils.getSystemFeature(o.featurePrefix,o.feature.maxSize)||M)*1024*1024,_={sendCode:[t.Validators.maxLen(null,20),t.Validators.minLen(null,1)],extractCode:[t.Validators.notNull()],file:[t.Validators.requireFile(),t.Validators.fileMaxSize(E)],message:[t.Validators.maxLen(null,255)]},R=async()=>{const r=await g.value.validate();if(!r.valid){t.SfcUtils.snackbar("\u6821\u9A8C\u5931\u8D25:"+r.errors.map(l=>l.errorMessages).join(";"));return}const a=t.SfcUtils.loadingDialog({msg:"\u6B63\u5728\u83B7\u53D6\u5206\u4EAB\u4FE1\u606F"});try{const i=(await t.SfcUtils.request(o.getByCode(u.value))).data.data;i.message?t.SfcUtils.alert(i.message,"\u63D0\u53D6\u6210\u529F - \u7559\u8A00").then(()=>t.SfcUtils.openApiUrl(o.getShareFile(i.id))):t.SfcUtils.openApiUrl(o.getShareFile(i.id))}catch(l){t.SfcUtils.alert("\u83B7\u53D6\u9519\u8BEF: "+l),console.error(l)}finally{a.close()}},W=async()=>{const r=await C.value.validate();if(!r.valid){t.SfcUtils.snackbar("\u6821\u9A8C\u5931\u8D25:"+r.errors.map(d=>d.errorMessages).join(";"));return}const a=e.reactive({msg:"\u4E0A\u4F20\u4E2D"}),l=t.SfcUtils.loadingDialog(a),i=o.upload(V.value[0],{code:c.value,message:h.value});i.onUploadProgress=d=>{a.msg="\u4E0A\u4F20\u4E2D..."+(d.loaded/d.total*100).toFixed(2)+"%"};try{const f=(await t.SfcUtils.request(i)).data.data;let F=["\u53D1\u9001\u6210\u529F\uFF0C\u63D0\u53D6\u7801\u4E3A\uFF1A"+f];f!=c.value&&F.push("(\u63D0\u53D6\u7801\u51B2\u7A81\uFF0C\u7CFB\u7EDF\u968F\u673A\u65B0\u751F\u6210)");const m=t.StringUtils.appendPath(location.origin,"/#/box/quick-share?code="+f);t.SfcUtils.openComponentDialog(e.h("div",null,[...F.map(x=>e.h("div",null,x)),e.h("div",null,[e.h("span",null,"\u63D0\u53D6\u94FE\u63A5\uFF1A"),e.h("a",{class:"link",onClick:()=>{t.SfcUtils.copyToClipboard(m),t.SfcUtils.snackbar("\u590D\u5236\u6210\u529F")}},m)]),e.h("div",null,"\u6216\u901A\u8FC7\u3010\u767E\u5B9D\u7BB1 - \u6587\u4EF6\u6781\u901F\u4F20\u3011\u529F\u80FD\u4E2D\u76F4\u63A5\u8F93\u5165\u63D0\u53D6\u7801\u63D0\u53D6")]),{showCancel:!1})}catch(d){t.SfcUtils.alert("\u53D1\u9001\u5931\u8D25: "+d),console.error(d)}finally{l.close()}},$=async()=>{var a;const r=(a=t.context.routeInfo.value.curr)==null?void 0:a.query;r&&r.code&&(u.value=r.code)};return e.onMounted(()=>{$()}),(r,a)=>{const l=e.resolveComponent("CommonIcon"),i=e.resolveComponent("v-tab"),d=e.resolveComponent("v-tabs"),f=e.resolveComponent("v-text-field"),F=e.resolveComponent("VBtn"),m=e.resolveComponent("VForm"),x=e.resolveComponent("VWindowItem"),j=e.resolveComponent("v-file-input"),L=e.resolveComponent("VTextarea"),Q=e.resolveComponent("VWindow"),G=e.resolveComponent("VCardContent"),H=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",U,[e.createVNode(H,{title:"\u6587\u4EF6\u6781\u901F\u4F20"},{default:e.withCtx(()=>[e.createVNode(d,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=n=>s.value=n),"bg-color":"primary",color:"primary"},{default:e.withCtx(()=>[e.createVNode(i,{value:"1"},{default:e.withCtx(()=>[e.createVNode(l,{icon:"mdi-folder-download"}),b]),_:1}),e.createVNode(i,{value:"2"},{default:e.withCtx(()=>[e.createVNode(l,{icon:"mdi-send"}),A]),_:1})]),_:1},8,["modelValue"]),e.createVNode(G,null,{default:e.withCtx(()=>[e.createVNode(Q,{modelValue:s.value,"onUpdate:modelValue":a[5]||(a[5]=n=>s.value=n)},{default:e.withCtx(()=>[e.createVNode(x,{value:"1"},{default:e.withCtx(()=>[e.createVNode(m,{ref_key:"extractFormRef",ref:g},{default:e.withCtx(()=>[e.createElementVNode("div",k,[e.createVNode(f,{modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=n=>u.value=n),clearable:"",label:"\u8BF7\u8F93\u5165\u6587\u4EF6\u63D0\u53D6\u7801",color:"primary",rules:_.extractCode,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(F,{color:"primary",style:{display:"block",width:"100%"},onClick:R},{default:e.withCtx(()=>[B]),_:1})])]),_:1},512)]),_:1}),e.createVNode(x,{value:"2"},{default:e.withCtx(()=>[e.createVNode(m,{ref_key:"sendFormRef",ref:C},{default:e.withCtx(()=>[e.createElementVNode("div",q,[e.createTextVNode(" \u6587\u4EF6\u4FDD\u7559\u65F6\u957F\uFF1A"+e.toDisplayString(e.unref(t.SfcUtils).getSystemFeature(e.unref(o).featurePrefix,e.unref(o).feature.effectiveDuration)||30)+"\u5206\u949F",1),T,e.createTextVNode(" \u6587\u4EF6\u5927\u5C0F\u9650\u5236\uFF1A"+e.toDisplayString(e.unref(t.StringFormatter).toSize(E)),1)]),e.createElementVNode("div",P,[e.createVNode(j,{modelValue:e.unref(V),"onUpdate:modelValue":a[2]||(a[2]=n=>e.isRef(V)?V.value=n:null),label:"\u8BF7\u9009\u62E9\u6587\u4EF6",rules:_.file,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(f,{modelValue:c.value,"onUpdate:modelValue":a[3]||(a[3]=n=>c.value=n),clearable:"",label:"\u8BF7\u8F93\u5165\u6587\u4EF6\u63D0\u53D6\u7801",color:"primary",rules:_.sendCode,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(L,{modelValue:h.value,"onUpdate:modelValue":a[4]||(a[4]=n=>h.value=n),rules:_.message,label:"\u7559\u8A00",color:"primary",variant:"outlined"},null,8,["modelValue","rules"]),e.createVNode(F,{color:"primary",style:{display:"block",width:"100%"},onClick:W},{default:e.withCtx(()=>[e.createVNode(l,{icon:"mdi-send"}),I]),_:1})])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])}}}));window.bootContext.addProcessor({taskName:"\u6CE8\u518C\u7EC4\u4EF6 - \u6587\u4EF6\u5FEB\u901F\u4F20",execute(p){if(!t.SfcUtils.getSystemFeature(o.featurePrefix,o.feature.isEnabled))return;p.component(D.name,D);const s=t.context.menu.value.boxMenu.find(c=>c.id=="shareAndCollection"),u={id:"quick-share",icon:"mdi-flash",title:"\u6587\u4EF6\u6781\u901F\u4F20",action(c){c.title="\u6587\u4EF6\u6781\u901F\u4F20",c.currentComponent="quick-share-view"}};s?s.items.push(u):t.context.menu.value.boxMenu.push({id:"shareAndCollection",name:"\u6587\u4EF6\u4EA4\u6D41",items:[u]})}})});
